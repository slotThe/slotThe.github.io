<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
      <meta name="robots" content="noai, noimageai">
    

    
      <title>Integer Volutes in BQN Â· Tony Zorman</title>
    

    <link rel="shortcut icon" href="../favicon.png">
    <!-- https://purecss.io/ -->
    <link rel="stylesheet" type="text/css" href="../css/pure-min.css" />
    <link rel="stylesheet" type="text/css" href="../css/skin.css" />
    <!-- Default appearance -->
    <link rel="stylesheet" type="text/css" href="../css/colours.css" />
    <link rel="stylesheet" type="text/css" href="../css/fonts.css" />
    <link rel="stylesheet" type="text/css" href="../css/default.css" />
    <!-- Syntax highlighting -->
    <link rel="stylesheet" type="text/css" href="../css/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../css/katex.css" />
    <!-- Margin and sidenotes -->
    <link rel="stylesheet" type="text/css" href="../css/sidenotes.css" />
  </head>

  <body class="pure-skin-solid">
    <div class="pure-g-r">
      <div class="pure-u-1-4">
        <div id="navigation" class="no-print">
          <div class="pure-menu pure-menu-open">
            <a href="../" class="pure-menu-heading menu-title">
              Blog<br>
              <span class="menu-subtitle">Tony Zorman</span>
            </a>
            <ul>
              <li><a href="../posts.html">Posts</a></li>
              <li><a href="../research.html">Research</a></li>
              <li><a href="../free-software.html">Free Software</a></li>
              <li><a href="../about.html">About</a></li>
            </ul>
          </div>
        </div>
        <!-- A table of contents on the left side, but only for screens
             that are big enough -->
         
          <div id="contents-big">
            <p class="mini-header">Contents <a id="up-arrow" href="#">â†‘</a></p>
            <ul>
<li><a href="#the-coordinate-based-solution">The coordinate based solution</a></li>
<li><a href="#a-flat-solution">A flat solution</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
          </div>
         
      </div>
      <div class="pure-u-3-4">
        <div id="content">
          <!-- We want to include the RSS/Atom feed in certain scenarios,
               but this shouldn't mangle the above header title. -->
           
            <h1>Integer Volutes in BQN</h1>
           

          <article>
    <p class="header">
      
        Posted on 2024-11-08
      
      
      
        &thinsp;Â·&thinsp; <span title="3023 words">13 min read</span> &thinsp;Â·&nbsp;
      
      
        <a title="All pages tagged 'BQN'." href="../tags/BQN.html" rel="tag">BQN</a>
      
    </p>
    <section>
      <!-- A table of contents inline in the text, in case the screen is
           too small for the one in the `default.html' template -->
      <!-- A table of contents inline in the text, in case the screen is too
     small for the one in the `default.html' template -->

  <div id="contents">
    <p class="mini-header">Contents</p>
    <ul>
<li><a href="#the-coordinate-based-solution">The coordinate based solution</a></li>
<li><a href="#a-flat-solution">A flat solution</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
  </div>

<div>
  On <a href="https://tony-zorman.com/posts/aoc-in-bqn.html#day-3" class="local-link">day 3</a>
of my post about doing some
<a href="https://tony-zorman.com/posts/aoc-in-bqn.html" class="local-link">Advent of Code problems in <span class="small-caps">bqn</span></a>,
the task was to walk along some <em>integer volutes</em>:
spirals, either spiralling inwardsâ€”involutesâ€”or outwardsâ€”evolutesâ€”in either direction.
While the specific problem didnâ€™t require it,
I think itâ€™s a pretty neat exercise to think about how to generate these things.
Letâ€™s talk about that.
<!--more-->
<p></p>
For example, the following is a left-spiraling evolute.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="o">Evolute</span><span class="w"> </span><span class="m">9</span>
<span class="err">â”Œâ”€</span>
<span class="err">â•µ</span><span class="w"> </span><span class="m">64</span><span class="w"> </span><span class="m">63</span><span class="w"> </span><span class="m">62</span><span class="w"> </span><span class="m">61</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="m">59</span><span class="w"> </span><span class="m">58</span><span class="w"> </span><span class="m">57</span><span class="w"> </span><span class="m">56</span>
<span class="w">  </span><span class="m">65</span><span class="w"> </span><span class="m">36</span><span class="w"> </span><span class="m">35</span><span class="w"> </span><span class="m">34</span><span class="w"> </span><span class="m">33</span><span class="w"> </span><span class="m">32</span><span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="m">55</span>
<span class="w">  </span><span class="m">66</span><span class="w"> </span><span class="m">37</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">54</span>
<span class="w">  </span><span class="m">67</span><span class="w"> </span><span class="m">38</span><span class="w"> </span><span class="m">17</span><span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="m">3</span><span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">28</span><span class="w"> </span><span class="m">53</span>
<span class="w">  </span><span class="m">68</span><span class="w"> </span><span class="m">39</span><span class="w"> </span><span class="m">18</span><span class="w">  </span><span class="m">5</span><span class="w">  </span><span class="m">0</span><span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">27</span><span class="w"> </span><span class="m">52</span>
<span class="w">  </span><span class="m">69</span><span class="w"> </span><span class="m">40</span><span class="w"> </span><span class="m">19</span><span class="w">  </span><span class="m">6</span><span class="w">  </span><span class="m">7</span><span class="w">  </span><span class="m">8</span><span class="w">  </span><span class="m">9</span><span class="w"> </span><span class="m">26</span><span class="w"> </span><span class="m">51</span>
<span class="w">  </span><span class="m">70</span><span class="w"> </span><span class="m">41</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">25</span><span class="w"> </span><span class="m">50</span>
<span class="w">  </span><span class="m">71</span><span class="w"> </span><span class="m">42</span><span class="w"> </span><span class="m">43</span><span class="w"> </span><span class="m">44</span><span class="w"> </span><span class="m">45</span><span class="w"> </span><span class="m">46</span><span class="w"> </span><span class="m">47</span><span class="w"> </span><span class="m">48</span><span class="w"> </span><span class="m">49</span>
<span class="w">  </span><span class="m">72</span><span class="w"> </span><span class="m">73</span><span class="w"> </span><span class="m">74</span><span class="w"> </span><span class="m">75</span><span class="w"> </span><span class="m">76</span><span class="w"> </span><span class="m">77</span><span class="w"> </span><span class="m">78</span><span class="w"> </span><span class="m">79</span><span class="w"> </span><span class="m">80</span>
<span class="w">                             </span><span class="err">â”˜</span>
</pre></div>

<p></p>
Quite pretty, isnâ€™t it?
<p></p>
Before we start, a big disclaimer:
this is neither my work, nor did I come up with any of the novel insights presented here.
Rather, there is an article by Eugene McDonnell (available
<a href="https://code.jsoftware.com/wiki/Doc/Articles/Play132">here</a>
or <a href="https://www.jsoftware.com/papers/play132.htm">here</a>)
who talks about a solution to this problem by Joey Tuttle.<!--
--><label for="sn-0" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-0" class="margin-toggle" /><div class="sidenote">Special thanks to Marshall Lochbaum for providing these links.</div><!--
-->
Both of the links above are not entirely satisfactory digitisations of the original article,
so in writing this post Iâ€™m trying to contribute a perhaps more palatable version.<!--
--><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle" /><div class="sidenote">Plus, I donâ€™t know any J, so reading the article in detail is a lot more work than just writing it in <span class="small-caps">bqn</span> myself.</div><!--
-->
<p></p>
This post is written in the <span class="small-caps">repl</span>-like fashion that Iâ€™ve already used above:
input is indented by four spaces,
and output is flush to the left.
As such, there will be lots of examples that highlight certain aspects of the current sub-problem to be solved.
<p></p>
Finally, the article probably wonâ€™t make much sense unless you know a little bit of <span class="small-caps">bqn</span> already,
the basics of which are probably best learned from the
<a href="https://mlochbaum.github.io/BQN/">official website</a>.
<h2 id="the-coordinate-based-solution">The coordinate based solution<a href="#the-coordinate-based-solution" class="floatleft sec-link">Â§</a></h2>
<p></p>
Letâ€™s initially produce a coordinate-based solution.
Our first sub-goal is to generate the correct indices in order.
Put the origin <code>âŸ¨0 0âŸ©</code> into the middle, at the number <code>0</code>.
Our coordinate system will be that of indexing into the array; i.e.,
<code>0â€¿1</code>, <code>Â¯1â€¿0</code>, <code>0â€¿Â¯1</code>, and <code>1â€¿0</code> represent east, north, west, and south, respectively.
Looking at the 9Ã—9 spiral above,
letâ€™s think about what kind of steps weâ€™re taking:
<div class="highlight-text" style="padding-left: 1em;"><pre><span></span>0  -E-&gt;  1  -N-&gt;  2  -W-&gt;  3  -W-&gt;  4  -S-&gt;  5  -S-&gt;  6  -E-&gt;  7  -E-&gt;  8 â€¦
</pre></div>

<p></p>
Just writing out the directions yields something like <code>ENWWSSEEENNNWWWWSSSSâ€¦</code>.
We alternate between east, north, west, and south in that order,
and always bunch up two of them with the same frequencyâ€”first one, then two, etc.
In particular, we â€œbreak intoâ€ a new iteration in the spiralling
every time a number is increased:
<div class="highlight-text" style="padding-left: 1em;"><pre><span></span>0     0 1       2     4 3 2     4 3 2     4 3 2
              0 1       0 1     5 0 1     5 0 1
                                6         6 7 8 9
</pre></div>

<p></p>
If we want to end up with a square,
our sequence would look like <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>â€¦</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi><mo separator="true">,</mo><mi>k</mi><mo separator="true">,</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">1, 1, 2, 2, â€¦ k-1, k-1, k, k, k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>;
repeating the last number three times instead of continuing with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>.
<p></p>
All in all, we need to generate two sequences of numbers:
the coordinates, and their associated frequencies.
Given a grid of size <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>, some quick maths tells us that
we have to generate a sequence with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2n - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> directions.<!--
--><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle" /><div class="sidenote">The frequencies have to add up to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n^2 - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>, covering all points but the origin.
A given sequence <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo separator="true">,</mo><mn>1</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mn>2</mn><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi><mo>âˆ’</mo><mn>1</mn><mo separator="true">,</mo><mi>k</mi><mo separator="true">,</mo><mi>k</mi><mo separator="true">,</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">1, 1, 2, 2, \dots, k-1, k-1, k, k, k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> has <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2k + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> members
and sums up to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>k</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn><mi>k</mi></mrow><annotation encoding="application/x-tex">k^2 + 2k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>.
Solving <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>k</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn><mi>k</mi><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k^2 + 2k = n^2 - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> has sensible roots,
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>Â±</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\pm n - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord">Â±</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>, of which we of course pick <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>.
Substituting <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k=n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>,
we have to generate <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2n - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">2</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> frequencies,
the values of which indeed sum up to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mn>2</mn><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><msup><mi>n</mi><mn>2</mn></msup><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">(n-1)^2 + 2(n-1) = n^2 - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8974em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>.</div><!--
-->
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="ni">ğ•©</span><span class="o">Ã—</span><span class="m">2</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">0</span><span class="p">â€¿</span><span class="m">1</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">â€¿</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">â€¿</span><span class="m">Â¯1</span><span class="p">,</span><span class="m">1</span><span class="p">â€¿</span><span class="m">0</span><span class="p">âŸ©</span><span class="w"> </span><span class="kt">}</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c1"># Generate this many indices</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="kt">{</span><span class="sr">(</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="o">âˆ¾</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="kt">}</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c1"># Double with an extra bit at the end</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
For doubling a given vector of numbers,
we can conveniently use
<em>replicate</em> (<a href="https://mlochbaum.github.io/BQN/doc/replicate.html"><code>/</code></a>),
and then manually add the number that should be repeated three times to the end.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="o">ğ•Š</span><span class="nv">n</span><span class="ni">:</span><span class="w"> </span><span class="c1"># Smush everything together.</span>
<span class="w">      </span><span class="sr">((</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="o">âˆ¾</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="kt">{</span><span class="o">&lt;</span><span class="na">Ë˜</span><span class="ni">ğ•¨</span><span class="p">â€¿</span><span class="m">2</span><span class="o">â¥Š</span><span class="ni">ğ•©</span><span class="kt">}</span><span class="na">Â¨</span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="nv">n</span><span class="o">Ã—</span><span class="m">2</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">0</span><span class="p">â€¿</span><span class="m">1</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">â€¿</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">â€¿</span><span class="m">Â¯1</span><span class="p">,</span><span class="m">1</span><span class="p">â€¿</span><span class="m">0</span><span class="p">âŸ©</span>
<span class="w">    </span><span class="kt">}</span><span class="w"> </span><span class="m">3</span>
<span class="err">â”Œâ”€</span>
<span class="m">Â·</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">                                                                                         </span><span class="err">â”˜</span>
<span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="o">ğ•Š</span><span class="nv">n</span><span class="ni">:</span><span class="w"> </span><span class="c1"># Flatten.</span>
<span class="w">      </span><span class="o">âˆ¾</span><span class="sr">((</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="o">âˆ¾</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="nv">n</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="kt">{</span><span class="o">&lt;</span><span class="na">Ë˜</span><span class="ni">ğ•¨</span><span class="p">â€¿</span><span class="m">2</span><span class="o">â¥Š</span><span class="ni">ğ•©</span><span class="kt">}</span><span class="na">Â¨</span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="nv">n</span><span class="o">Ã—</span><span class="m">2</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">0</span><span class="p">â€¿</span><span class="m">1</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">â€¿</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">â€¿</span><span class="m">Â¯1</span><span class="p">,</span><span class="m">1</span><span class="p">â€¿</span><span class="m">0</span><span class="p">âŸ©</span>
<span class="w">    </span><span class="kt">}</span><span class="w"> </span><span class="m">3</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
Smushing everything together works by
<em>reshaping</em> (<a href="https://mlochbaum.github.io/BQN/doc/reshape.html"><code>â¥Š</code></a>)
the vector of length two into an array with two columns,
and as many rows as the desired frequency.
Flattening everything is done by calling
<em>enclose</em> (<a href="https://mlochbaum.github.io/BQN/doc/enclose.html"><code>&lt;</code></a>)
on each major cell.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="m">3</span><span class="w"> </span><span class="kt">{</span><span class="ni">ğ•¨</span><span class="p">â€¿</span><span class="m">2</span><span class="o">â¥Š</span><span class="ni">ğ•©</span><span class="kt">}</span><span class="w"> </span><span class="m">Â¯1</span><span class="p">â€¿</span><span class="m">0</span>
<span class="err">â”Œâ”€</span>
<span class="err">â•µ</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span>
<span class="w">  </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span>
<span class="w">  </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span>
<span class="w">       </span><span class="err">â”˜</span>
<span class="w">    </span><span class="m">3</span><span class="w"> </span><span class="kt">{</span><span class="o">&lt;</span><span class="na">Ë˜</span><span class="ni">ğ•¨</span><span class="p">â€¿</span><span class="m">2</span><span class="o">â¥Š</span><span class="ni">ğ•©</span><span class="kt">}</span><span class="w"> </span><span class="m">Â¯1</span><span class="p">â€¿</span><span class="m">0</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
This yields the function to generate a vector of directions.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="o">Dirs</span><span class="w"> </span><span class="kd">â†</span><span class="w"> </span><span class="kt">{</span><span class="w"> </span><span class="o">ğ•Š</span><span class="nv">n</span><span class="ni">:</span><span class="w"> </span><span class="c1"># Directions for an nÃ—n grid</span>
<span class="w">      </span><span class="o">âˆ¾</span><span class="sr">((</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="o">âˆ¾</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="kt">{</span><span class="o">&lt;</span><span class="na">Ë˜</span><span class="ni">ğ•¨</span><span class="p">â€¿</span><span class="m">2</span><span class="o">â¥Š</span><span class="ni">ğ•©</span><span class="kt">}</span><span class="na">Â¨</span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="nv">n</span><span class="o">Ã—</span><span class="m">2</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">0</span><span class="p">â€¿</span><span class="m">1</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">â€¿</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">â€¿</span><span class="m">Â¯1</span><span class="p">,</span><span class="m">1</span><span class="p">â€¿</span><span class="m">0</span><span class="p">âŸ©</span>
<span class="w">    </span><span class="kt">}</span>
<span class="sr">(</span><span class="nv">function</span><span class="w"> </span><span class="nv">block</span><span class="sr">)</span>
</pre></div>

<p></p>
To get the coordinates, we just have to â€œwalk the pathâ€â€”that is,
compute the
<code>+</code>-<em>scan</em> (<a href="https://mlochbaum.github.io/BQN/doc/scan.html"><code>`</code></a>)
and add the origin.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="o">Coords</span><span class="w"> </span><span class="kd">â†</span><span class="w"> </span><span class="kt">{</span><span class="w"> </span><span class="sr">(</span><span class="o">&lt;</span><span class="m">0</span><span class="p">â€¿</span><span class="m">0</span><span class="sr">)</span><span class="o">âˆ¾</span><span class="w"> </span><span class="o">+</span><span class="na">`</span><span class="w"> </span><span class="o">Dirs</span><span class="ni">ğ•©</span><span class="w"> </span><span class="kt">}</span>
<span class="sr">(</span><span class="nv">function</span><span class="w"> </span><span class="nv">block</span><span class="sr">)</span>
<span class="w">    </span><span class="o">Coords</span><span class="w"> </span><span class="m">3</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
These coordinates are associated to the numbers that their respective index represents:
<code>0</code> for <code>âŸ¨0 0âŸ©</code>, <code>1</code> for <code>âŸ¨0 1âŸ©</code>, and so on.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="sr">(</span><span class="o">â†•</span><span class="m">9</span><span class="sr">)</span><span class="w"> </span><span class="o">â‰</span><span class="w"> </span><span class="o">Coords</span><span class="w"> </span><span class="m">3</span>
<span class="err">â”Œâ”€</span>
<span class="err">â•µ</span><span class="w"> </span><span class="m">0</span><span class="w">       </span><span class="m">1</span><span class="w">       </span><span class="m">2</span><span class="w">        </span><span class="m">3</span><span class="w">        </span><span class="m">4</span><span class="w">         </span><span class="m">5</span><span class="w">        </span><span class="m">6</span><span class="w">        </span><span class="m">7</span><span class="w">       </span><span class="m">8</span>
<span class="w">  </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">                                                                                </span><span class="err">â”˜</span>
</pre></div>

<p></p>
All thatâ€™s left to do is to <em>reshape</em> the argument into the correct form.
This uses the fact that coordinates have a nice lexicographic ordering.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="o">â†•</span><span class="m">3</span><span class="p">â€¿</span><span class="m">3</span><span class="w">          </span><span class="c1"># Origin top left</span>
<span class="err">â”Œâ”€</span>
<span class="err">â•µ</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">  </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">  </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">                          </span><span class="err">â”˜</span>
<span class="w">    </span><span class="sr">(</span><span class="o">â†•</span><span class="m">3</span><span class="p">â€¿</span><span class="m">3</span><span class="sr">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="o">&lt;</span><span class="m">1</span><span class="p">â€¿</span><span class="m">1</span><span class="w"> </span><span class="c1"># Origin in the middle, where we want it</span>
<span class="err">â”Œâ”€</span>
<span class="err">â•µ</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">  </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w">  </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w">  </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">  </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w">  </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w">  </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">                              </span><span class="err">â”˜</span>
</pre></div>

<p></p>
We first order the coordinates by their columns (the first number), and then by their rows (the second).
A verbose way of doing that would be the following:<!--
--><label for="sn-3" class="margin-toggle">âŠ•</label><input type="checkbox" id="sn-3" class="margin-toggle" /><div class="marginnote">Line breaks in the output for clarity.</div><!--
-->
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="sr">(</span><span class="o">Coords</span><span class="w"> </span><span class="m">3</span><span class="sr">)</span><span class="w"> </span><span class="o">â‹ˆ</span><span class="na">Â¨</span><span class="w"> </span><span class="o">â†•</span><span class="m">9</span><span class="w">        </span><span class="c1"># Zip coordinates to indices</span>
<span class="err">â”Œâ”€</span>
<span class="m">Â·</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">  </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">                                                                            </span><span class="err">â”˜</span>
<span class="w">    </span><span class="o">âˆ§</span><span class="w"> </span><span class="sr">(</span><span class="o">Coords</span><span class="w"> </span><span class="m">3</span><span class="sr">)</span><span class="w"> </span><span class="o">â‹ˆ</span><span class="na">Â¨</span><span class="w"> </span><span class="o">â†•</span><span class="m">9</span><span class="w">      </span><span class="c1"># Sort</span>
<span class="err">â”Œâ”€</span>
<span class="m">Â·</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">  </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">                                                                            </span><span class="err">â”˜</span>
<span class="w">    </span><span class="m">1</span><span class="o">âŠ‘</span><span class="na">Â¨</span><span class="w"> </span><span class="o">âˆ§</span><span class="w"> </span><span class="sr">(</span><span class="o">Coords</span><span class="w"> </span><span class="m">3</span><span class="sr">)</span><span class="w"> </span><span class="o">â‹ˆ</span><span class="na">Â¨</span><span class="w"> </span><span class="o">â†•</span><span class="m">9</span><span class="w">  </span><span class="c1"># Get indices</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="m">3</span><span class="p">â€¿</span><span class="m">3</span><span class="o">â¥Š</span><span class="m">1</span><span class="o">âŠ‘</span><span class="na">Â¨</span><span class="o">âˆ§</span><span class="sr">(</span><span class="o">Coords</span><span class="w"> </span><span class="m">3</span><span class="sr">)</span><span class="o">â‹ˆ</span><span class="na">Â¨</span><span class="o">â†•</span><span class="m">9</span><span class="w">  </span><span class="c1"># Reshape</span>
<span class="err">â”Œâ”€</span>
<span class="err">â•µ</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span>
<span class="w">  </span><span class="m">5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span>
<span class="w">        </span><span class="err">â”˜</span>
</pre></div>

<p></p>
This works, but feels a bit unsatisfactory.
We seem to be doing a lot of extra work just to get the correct ordering of the indices.
Luckily, <span class="small-caps">bqn</span> has a primitive functionâ€”two, actuallyâ€”that exactly encapsulates operations like the above:
a <em>grade</em>.
Briefly,
given an array with major cells <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>c</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>c</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(c_1, \dots, c_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>,
<em>grade up</em> (<a href="https://mlochbaum.github.io/BQN/doc/order.html#grade"><code>â‹</code></a>)
returns a permutation <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><msub><mi>i</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>i</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(i_1, \dots, i_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> of the indices,
which yields the order that would sort the cells:
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><msub><mi>i</mi><mn>1</mn></msub></msub></mrow><annotation encoding="application/x-tex">c_{i_1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6807em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span></span></span></span> is the smallest element, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><msub><mi>i</mi><mn>2</mn></msub></msub></mrow><annotation encoding="application/x-tex">c_{i_2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6807em;vertical-align:-0.2501em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2501em;"><span></span></span></span></span></span></span></span></span></span> is the second smallest, and so on.
This can be used to sort the vector by <em>picking</em> each <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>i</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">i_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9456em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> in order.<!--
--><label for="sn-4" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-4" class="margin-toggle" /><div class="sidenote">In fact, in <span class="small-caps">apl</span> this is the only way to do thisâ€”there is no other sorting primitive!</div><!--
-->
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="nv">a</span><span class="w"> </span><span class="kd">â†</span><span class="w"> </span><span class="p">âŸ¨</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">19</span><span class="p">,</span><span class="m">16</span><span class="p">âŸ©</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="nv">g</span><span class="w"> </span><span class="kd">â†</span><span class="w"> </span><span class="o">â‹</span><span class="nv">a</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="sr">(</span><span class="o">âŠ‘</span><span class="nv">g</span><span class="sr">)</span><span class="o">âŠ‘</span><span class="nv">a</span><span class="w">    </span><span class="c1"># smallest element</span>
<span class="m">0</span>
<span class="w">    </span><span class="sr">(</span><span class="m">Â¯1</span><span class="o">âŠ‘</span><span class="nv">g</span><span class="sr">)</span><span class="o">âŠ‘</span><span class="nv">a</span><span class="w">  </span><span class="c1"># Largest element</span>
<span class="m">19</span>
<span class="w">    </span><span class="nv">g</span><span class="o">âŠ</span><span class="nv">a</span><span class="w">       </span><span class="c1"># Sort: g is a vector of indices into a</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="c1"># Grading is the same as sorting and getting the indices</span>
<span class="w">    </span><span class="sr">(</span><span class="o">â‹</span><span class="nv">a</span><span class="sr">)</span><span class="w"> </span><span class="o">â‰¡</span><span class="w"> </span><span class="m">1</span><span class="o">âŠ‘</span><span class="na">Â¨</span><span class="o">âˆ§</span><span class="nv">a</span><span class="o">â‹ˆ</span><span class="na">Â¨</span><span class="o">â†•</span><span class="m">9</span>
<span class="m">1</span>
</pre></div>

<p></p>
Putting everything together, we can write the first version of <code>Evolute</code>.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="o">Evolute</span><span class="w"> </span><span class="kd">â†</span><span class="w"> </span><span class="kt">{</span><span class="w"> </span><span class="ni">ğ•©</span><span class="p">â€¿</span><span class="ni">ğ•©</span><span class="o">â¥Š</span><span class="w"> </span><span class="o">â‹</span><span class="w"> </span><span class="o">Coords</span><span class="ni">ğ•©</span><span class="w"> </span><span class="kt">}</span>
<span class="sr">(</span><span class="nv">function</span><span class="w"> </span><span class="nv">block</span><span class="sr">)</span>
<span class="w">    </span><span class="o">Evolute</span><span class="w"> </span><span class="m">3</span>
<span class="err">â”Œâ”€</span>
<span class="err">â•µ</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span>
<span class="w">  </span><span class="m">5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span>
<span class="w">        </span><span class="err">â”˜</span>
<span class="w">    </span><span class="o">Evolute</span><span class="w"> </span><span class="m">5</span>
<span class="err">â”Œâ”€</span>
<span class="err">â•µ</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">12</span>
<span class="w">  </span><span class="m">17</span><span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="m">3</span><span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">11</span>
<span class="w">  </span><span class="m">18</span><span class="w">  </span><span class="m">5</span><span class="w">  </span><span class="m">0</span><span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">10</span>
<span class="w">  </span><span class="m">19</span><span class="w">  </span><span class="m">6</span><span class="w">  </span><span class="m">7</span><span class="w">  </span><span class="m">8</span><span class="w">  </span><span class="m">9</span>
<span class="w">  </span><span class="m">20</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">24</span>
<span class="w">                 </span><span class="err">â”˜</span>
</pre></div>

<p></p>
Nice.
<h2 id="a-flat-solution">A flat solution<a href="#a-flat-solution" class="floatleft sec-link">Â§</a></h2>
<p></p>
While I think <code>Evolute</code> is quite neat,
a fun aspect of array programming is to come up with
<a href="https://saltysylvi.github.io/blog/flat1.html">completely</a>
<a href="https://saltysylvi.github.io/blog/flat2.html">flat</a>
solutions to problems.
That is, solutions that do not use any nested arraysâ€”like vectors of coordinatesâ€”whatsoever.
This is often much more efficient,
and may yield new insights in how the problem actually works.
Plus, working in a more constrained setting can be fun just in and of itself.
<p></p>
Letâ€™s start with the flat version of the completed spiral.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="nv">spiral</span><span class="w"> </span><span class="kd">â†</span><span class="w"> </span><span class="o">â¥ŠEvolute</span><span class="w"> </span><span class="m">3</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
Naively, the general strategy is this:
throw transformations <code>fáµ¢</code> at <code>spiral</code>
until we arrive at some vector <code>v</code> that is reasonably easy to generate;
i.e., <code>v â‰¡ fâ‚ â€¦ fâ‚™ spiral</code>.
Then, invert all of the <code>fáµ¢</code> to re-generate the original vector:
<code>spiral â‰¡ fâ‚™â»Â¹ â€¦ fâ‚â»Â¹ v</code>.<!--
--><label for="sn-5" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-5" class="margin-toggle" /><div class="sidenote">Note that, in particular, we are interested in left inverses of all the <code>fáµ¢</code>.
This is a bit in opposition to the facilities that <span class="small-caps">bqn</span> provides by default, like
<em>undo</em> to find the right inverse.
However, weâ€™ll manage.</div><!--
-->
As far as I can tell, one just needs enough intuition about these flat arrays to guess nice enough functions.
<p></p>
Now, from the first solution we already know that <code>spiral</code> is the <em>grade</em> of some list of coordinates,
which we however have no hope of recovering.
After enough staring, one notices that <code>spiral</code> itself looks like a permutation<!--
-->â€”why not try to find the inverse of that?
Thankfully this is very easy, as <em>grade up</em> is self-inverse in this case:<!--
--><label for="sn-6" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-6" class="margin-toggle" /><div class="sidenote">A quick justification:
suppose that we have a vector <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo><mpadded class="vcenter"><mo lspace="0em" rspace="0em">:</mo></mpadded></mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>n</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>n</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">n \mathrel{\vcenter{:}}= (n_1, \dots, n_k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.4653em;"><span style="top:-3.0347em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">:</span></span></span></span></span></span></span></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> of natural numbers,
such that every number from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span> appears exactly once.
Using <em>grade up</em>, we obtain a permutation <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ïƒ</mi><mo><mpadded class="vcenter"><mo lspace="0em" rspace="0em">:</mo></mpadded></mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>i</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>i</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sigma \mathrel{\vcenter{:}}= (i_1, \dots, i_k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.4653em;"><span style="top:-3.0347em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">:</span></span></span></span></span></span></span></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>.
If one <em>grades</em> that permutation in the same direction,
then whatever index <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>i</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">i_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9456em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span> has value <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>
will be the very first element of the new permutation <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï„</mi><mo><mpadded class="vcenter"><mo lspace="0em" rspace="0em">:</mo></mpadded></mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>i</mi><mi>j</mi></msub><mo separator="true">,</mo><mo>â€¦</mo><mo separator="true">,</mo><msub><mi>i</mi><mi mathvariant="normal">â„“</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\tau \mathrel{\vcenter{:}}= (i_j, \dots, i_\ell)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4653em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">Ï„</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.4653em;"><span style="top:-3.0347em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">:</span></span></span></span></span></span></span></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">â€¦</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">â„“</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>,
and likewise for the other numbers.
Thus, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Ï„</mi><mi>Ïƒ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo><mo>=</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\tau \sigma (n) = n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.1132em;">Ï„</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span>.
<p></p>
Of course, <code>â‹â‹</code> it not the identity in general, but it is a useful operation nonetheless:
it â€œranksâ€ the elements of the input,
with <code>0</code> corresponding to the smallest element, and so on.
This is known as the
<a href="https://mlochbaum.github.io/BQN/doc/order.html#ordinals">ordinal idiom</a>.</div><!--
-->
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="o">â‹â‹</span><span class="nv">spiral</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="nv">spiral</span><span class="o">â‰¡â‹â‹</span><span class="nv">spiral</span>
<span class="m">1</span>
<span class="w">    </span><span class="o">â‹</span><span class="nv">spiral</span><span class="w"> </span><span class="c1"># This is the permutation we want.</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
I think that <code>â‹spiral</code> doesnâ€™t look any less random than <code>spiral</code>,
but Tuttle evidently saw something,
and instead checked whether this list was the running sum of a good one;
i.e., whether there exists some nice <code>y</code> such that <code>(â‹spiral) â‰¡ +`y</code>.
This in particular means that we have to compute the inverse of <code>+`</code>:
subtract each element from its predecessor, or <code>-âŸœÂ»</code> for short.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="o">-</span><span class="py">âŸœ</span><span class="o">Â»</span><span class="w"> </span><span class="o">â‹</span><span class="nv">spiral</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯3</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="o">+</span><span class="na">`</span><span class="w"> </span><span class="o">-</span><span class="py">âŸœ</span><span class="o">Â»</span><span class="w"> </span><span class="o">â‹</span><span class="nv">spiral</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="sr">(</span><span class="o">â‹</span><span class="nv">spiral</span><span class="sr">)</span><span class="w"> </span><span class="o">â‰¡</span><span class="w"> </span><span class="sr">(</span><span class="o">+</span><span class="na">`</span><span class="o">-</span><span class="py">âŸœ</span><span class="o">Â»â‹</span><span class="nv">spiral</span><span class="sr">)</span>
<span class="m">1</span>
</pre></div>

<p></p>
In fact, we can even ask <span class="small-caps">bqn</span> to do this for us by means of
<em>undo</em> (<a href="https://mlochbaum.github.io/BQN/doc/undo.html"><code>â¼</code></a>).
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="o">+</span><span class="na">`â¼</span><span class="w"> </span><span class="o">â‹</span><span class="nv">spiral</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯3</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
Finally, this looks like something we can generate!
Letâ€™s take a look at a 5Ã—5 grid, so the structure becomes even more obvious:
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="o">+</span><span class="na">`â¼</span><span class="o">â‹â¥ŠEvolute</span><span class="w"> </span><span class="m">5</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">12</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
Ignoring the number at the start, we have an alternation of <code>1 Â¯n Â¯1 n</code>, where <code>n</code> is the size of the evolute.
Disregarding multiple occurrences and the first number,
there are exactly <code>(2Ã—n)-1</code> â€œprimitiveâ€ numbers
to which we need to associate frequencies,
which matches with the coordinate generation from before.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">Ã—</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="ni">ğ•©</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">,</span><span class="ni">ğ•©</span><span class="p">âŸ©</span><span class="w"> </span><span class="kt">}</span><span class="w"> </span><span class="m">3</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯3</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">Ã—</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="ni">ğ•©</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">,</span><span class="ni">ğ•©</span><span class="p">âŸ©</span><span class="w"> </span><span class="kt">}</span><span class="w"> </span><span class="m">5</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
These numbers grow in their frequency in blocks of two; first one of each, then two, and so on.
Everything here is entirely analogous to the coordinate case,
including the fact that we need to repeat the last number three times in order to obtain a square grid.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="w"> </span><span class="kt">}</span><span class="w"> </span><span class="m">5</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="sr">(</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="o">âˆ¾</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="w"> </span><span class="kt">}</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c1"># Need correcting term at the end</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="sr">((</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="o">âˆ¾</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="o">/</span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">Ã—</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="ni">ğ•©</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">,</span><span class="ni">ğ•©</span><span class="p">âŸ©</span><span class="w"> </span><span class="kt">}</span><span class="w"> </span><span class="m">3</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯3</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
As for the first number that we ignored so far: itâ€™s not actually important!
What we do with this list is a <code>+</code>-<em>scan</em>, followed by a <em>grade up</em> to sort the indices.
This means that only the relative value of the <em>scan</em> is important for the following <em>grade</em>,
so outside of special cases like <code>âˆ</code>, the first number could be almost anything.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="m">0</span><span class="o">âˆ¾</span><span class="sr">((</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="o">âˆ¾</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="o">/</span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">Ã—</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="ni">ğ•©</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">,</span><span class="ni">ğ•©</span><span class="p">âŸ©</span><span class="w"> </span><span class="kt">}</span><span class="w"> </span><span class="m">5</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
In particular, this opens up a nice shortcut.
Instead of manually adding <code>ğ•©-1</code> to the back and <code>0</code> to the front,
we can just add <code>ğ•©</code> itself to the back,
and then <em>nudge</em> the whole array to the right,
inserting the filler <code>0</code> as the first element.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="m">0</span><span class="o">âˆ¾</span><span class="sr">((</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="o">âˆ¾</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="w"> </span><span class="kt">}</span><span class="w"> </span><span class="m">5</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="o">Â»</span><span class="sr">(</span><span class="ni">ğ•©</span><span class="o">âˆ¾</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="w"> </span><span class="kt">}</span><span class="w"> </span><span class="m">5</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="o">Â»</span><span class="sr">(</span><span class="m">Â¯1</span><span class="o">â†“</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="w"> </span><span class="kt">}</span><span class="w"> </span><span class="m">5</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="p">âŸ©</span>
<span class="w">    </span><span class="kt">{</span><span class="w"> </span><span class="o">Â»</span><span class="sr">(</span><span class="m">Â¯1</span><span class="o">â†“</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="o">/</span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">Ã—</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="ni">ğ•©</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">,</span><span class="ni">ğ•©</span><span class="p">âŸ©</span><span class="w"> </span><span class="kt">}</span><span class="w"> </span><span class="m">5</span>
<span class="p">âŸ¨</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯5</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">Â¯1</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">âŸ©</span>
</pre></div>

<p></p>
We obtain a completely flat version of <code>Evolute</code>,
which works just like the original function.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="o">EvoluteFlat</span><span class="w"> </span><span class="kd">â†</span><span class="w"> </span><span class="kt">{</span><span class="w"> </span><span class="ni">ğ•©</span><span class="p">â€¿</span><span class="ni">ğ•©</span><span class="o">â¥Šâ‹+</span><span class="na">`</span><span class="o">Â»</span><span class="sr">(</span><span class="m">Â¯1</span><span class="o">â†“</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="o">/</span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">Ã—</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="ni">ğ•©</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">,</span><span class="ni">ğ•©</span><span class="p">âŸ©</span><span class="w"> </span><span class="kt">}</span>
<span class="sr">(</span><span class="nv">function</span><span class="w"> </span><span class="nv">block</span><span class="sr">)</span>
<span class="w">    </span><span class="o">EvoluteFlat</span><span class="w"> </span><span class="m">3</span>
<span class="err">â”Œâ”€</span>
<span class="err">â•µ</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">2</span>
<span class="w">  </span><span class="m">5</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="m">1</span>
<span class="w">  </span><span class="m">6</span><span class="w"> </span><span class="m">7</span><span class="w"> </span><span class="m">8</span>
<span class="w">        </span><span class="err">â”˜</span>
<span class="w">    </span><span class="o">EvoluteFlat</span><span class="w"> </span><span class="m">5</span>
<span class="err">â”Œâ”€</span>
<span class="err">â•µ</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">15</span><span class="w"> </span><span class="m">14</span><span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">12</span>
<span class="w">  </span><span class="m">17</span><span class="w">  </span><span class="m">4</span><span class="w">  </span><span class="m">3</span><span class="w">  </span><span class="m">2</span><span class="w"> </span><span class="m">11</span>
<span class="w">  </span><span class="m">18</span><span class="w">  </span><span class="m">5</span><span class="w">  </span><span class="m">0</span><span class="w">  </span><span class="m">1</span><span class="w"> </span><span class="m">10</span>
<span class="w">  </span><span class="m">19</span><span class="w">  </span><span class="m">6</span><span class="w">  </span><span class="m">7</span><span class="w">  </span><span class="m">8</span><span class="w">  </span><span class="m">9</span>
<span class="w">  </span><span class="m">20</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">24</span>
<span class="w">                 </span><span class="err">â”˜</span>
</pre></div>

<p></p>
Getting a rightwards spiral just involves
twiddling with the vector <code>âŸ¨1,-ğ•©,Â¯1,ğ•©âŸ©</code> a little bit.
Iâ€™ll leave that as an exercise for the interested reader.
<h2 id="conclusion">Conclusion<a href="#conclusion" class="floatleft sec-link">Â§</a></h2>
<p></p>
Hereâ€™s a complete definition of both solutions.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="o">E1</span><span class="w"> </span><span class="kd">â†</span><span class="w"> </span><span class="kt">{</span><span class="ni">ğ•©</span><span class="p">â€¿</span><span class="ni">ğ•©</span><span class="o">â¥Šâ‹</span><span class="sr">(</span><span class="o">&lt;</span><span class="m">0</span><span class="p">â€¿</span><span class="m">0</span><span class="sr">)</span><span class="o">âˆ¾+</span><span class="na">`</span><span class="o">âˆ¾</span><span class="sr">((</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">2</span><span class="sr">)</span><span class="o">âˆ¾</span><span class="m">3</span><span class="o">â¥Š</span><span class="ni">ğ•©</span><span class="o">-</span><span class="m">1</span><span class="sr">)</span><span class="kt">{</span><span class="o">&lt;</span><span class="na">Ë˜</span><span class="ni">ğ•¨</span><span class="p">â€¿</span><span class="m">2</span><span class="o">â¥Š</span><span class="ni">ğ•©</span><span class="kt">}</span><span class="na">Â¨</span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="ni">ğ•©</span><span class="o">Ã—</span><span class="m">2</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">0</span><span class="p">â€¿</span><span class="m">1</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">â€¿</span><span class="m">0</span><span class="p">,</span><span class="m">0</span><span class="p">â€¿</span><span class="m">Â¯1</span><span class="p">,</span><span class="m">1</span><span class="p">â€¿</span><span class="m">0</span><span class="p">âŸ©</span><span class="kt">}</span>
<span class="o">E2</span><span class="w"> </span><span class="kd">â†</span><span class="w"> </span><span class="kt">{</span><span class="ni">ğ•©</span><span class="p">â€¿</span><span class="ni">ğ•©</span><span class="o">â¥Šâ‹+</span><span class="na">`</span><span class="o">Â»</span><span class="sr">(</span><span class="m">Â¯1</span><span class="o">â†“</span><span class="m">2</span><span class="o">/</span><span class="m">1</span><span class="o">+â†•</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="o">/</span><span class="sr">(</span><span class="m">1</span><span class="o">-</span><span class="na">Ëœ</span><span class="m">2</span><span class="o">Ã—</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="o">â¥Š</span><span class="p">âŸ¨</span><span class="m">1</span><span class="p">,</span><span class="o">-</span><span class="ni">ğ•©</span><span class="p">,</span><span class="m">Â¯1</span><span class="p">,</span><span class="ni">ğ•©</span><span class="p">âŸ©</span><span class="kt">}</span>
</pre></div>

<p></p>
I certainly think that <code>E2</code> is much prettier than <code>E1</code>;
not only because itâ€™s shorter, but also because there seems to be less wrangling to get everything to line up correctly.
Seeing these side by side does reveal that they use a lot of the same techniques,
however, which I think is interesting.
<hr />
<p></p>
As a bonus, here is the mandatory golfed solution,
this time as an involute.
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="o">G</span><span class="w"> </span><span class="kd">â†</span><span class="w"> </span><span class="kt">{</span><span class="sr">(</span><span class="o">âŠ’</span><span class="na">Ëœ</span><span class="o">âˆ¾â‰</span><span class="py">âˆ˜</span><span class="o">âŒ½+â‰ </span><span class="sr">)</span><span class="py">âŸ</span><span class="m">2</span><span class="py">âŸ</span><span class="ni">ğ•©</span><span class="o">â†•</span><span class="m">0</span><span class="p">â€¿</span><span class="m">0</span><span class="kt">}</span>
<span class="sr">(</span><span class="nv">function</span><span class="w"> </span><span class="nv">block</span><span class="sr">)</span>
<span class="w">    </span><span class="o">SLG</span><span class="w"> </span><span class="kd">â†</span><span class="w"> </span><span class="kt">{</span><span class="sr">(</span><span class="o">â†•</span><span class="py">âˆ˜</span><span class="o">â‰ âˆ¾â‰</span><span class="py">âˆ˜</span><span class="o">âŒ½+â‰ </span><span class="sr">)</span><span class="py">âŸ</span><span class="sr">(</span><span class="m">2</span><span class="o">Ã—</span><span class="ni">ğ•©</span><span class="sr">)</span><span class="o">â†•</span><span class="m">0</span><span class="p">â€¿</span><span class="m">0</span><span class="kt">}</span><span class="w"> </span><span class="c1"># Slighly less golfed</span>
<span class="sr">(</span><span class="nv">function</span><span class="w"> </span><span class="nv">block</span><span class="sr">)</span>
<span class="w">    </span><span class="o">G</span><span class="w"> </span><span class="m">5</span>
<span class="err">â”Œâ”€</span>
<span class="err">â•µ</span><span class="w">  </span><span class="m">0</span><span class="w">  </span><span class="m">1</span><span class="w">  </span><span class="m">2</span><span class="w">  </span><span class="m">3</span><span class="w"> </span><span class="m">4</span>
<span class="w">  </span><span class="m">15</span><span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="m">17</span><span class="w"> </span><span class="m">18</span><span class="w"> </span><span class="m">5</span>
<span class="w">  </span><span class="m">14</span><span class="w"> </span><span class="m">23</span><span class="w"> </span><span class="m">24</span><span class="w"> </span><span class="m">19</span><span class="w"> </span><span class="m">6</span>
<span class="w">  </span><span class="m">13</span><span class="w"> </span><span class="m">22</span><span class="w"> </span><span class="m">21</span><span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">7</span>
<span class="w">  </span><span class="m">12</span><span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">10</span><span class="w">  </span><span class="m">9</span><span class="w"> </span><span class="m">8</span>
<span class="w">                </span><span class="err">â”˜</span>
<span class="w">    </span><span class="sr">(</span><span class="o">SLG</span><span class="w"> </span><span class="m">5</span><span class="sr">)</span><span class="w"> </span><span class="o">â‰¡</span><span class="w"> </span><span class="o">G</span><span class="w"> </span><span class="m">5</span>
<span class="m">1</span>
</pre></div>

<p></p>
I will leave it to the interested reader to figure out that oneâ€”or to consult the
<a href="https://codegolf.stackexchange.com/questions/241803/print-a-nxn-integer-involute">relevant StackExchange thread</a>,
which I perhaps should have looked up before writing this whole thing.
Still, all of this transposing and reversing the matrix means that this solution is on the slower side.
Hereâ€™s a quick an dirty comparison:
<div class="highlight-bqn" style="padding-left: 1em;"><pre><span></span><span class="w">    </span><span class="sr">)</span><span class="nv">time</span><span class="w"> </span><span class="o">G</span><span class="w">   </span><span class="m">1000</span><span class="w">  </span><span class="c1"># Golfed version</span>
<span class="m">1.0114</span><span class="nv">s</span>
<span class="w">    </span><span class="sr">)</span><span class="nv">time</span><span class="w"> </span><span class="o">G</span><span class="w">   </span><span class="m">2000</span>
<span class="m">13.885</span><span class="nv">s</span>
<span class="w">    </span><span class="sr">)</span><span class="nv">time</span><span class="w"> </span><span class="o">SLG</span><span class="w"> </span><span class="m">1000</span><span class="w">  </span><span class="c1"># Slightly less golfed version</span>
<span class="m">651.3</span><span class="nv">ms</span>
<span class="w">    </span><span class="sr">)</span><span class="nv">time</span><span class="w"> </span><span class="o">SLG</span><span class="w"> </span><span class="m">2000</span>
<span class="m">8.1603</span><span class="nv">s</span>
<span class="w">    </span><span class="sr">)</span><span class="nv">time</span><span class="w"> </span><span class="o">E1</span><span class="w">  </span><span class="m">1000</span><span class="w">  </span><span class="c1"># Using indices</span>
<span class="m">218</span><span class="nv">ms</span>
<span class="w">    </span><span class="sr">)</span><span class="nv">time</span><span class="w"> </span><span class="o">E1</span><span class="w">  </span><span class="m">2000</span>
<span class="m">950.2</span><span class="nv">ms</span>
<span class="w">    </span><span class="sr">)</span><span class="nv">time</span><span class="w"> </span><span class="o">E2</span><span class="w">  </span><span class="m">1000</span><span class="w">  </span><span class="c1"># Flat</span>
<span class="m">4.197</span><span class="nv">ms</span>
<span class="w">    </span><span class="sr">)</span><span class="nv">time</span><span class="w"> </span><span class="o">E2</span><span class="w">  </span><span class="m">2000</span>
<span class="m">12.98</span><span class="nv">ms</span>
</pre></div>

<p></p>
While both are cubic and thus degrade fast,
<code>SLG</code> is faster than <code>G</code> because <code>â†•â‰ </code> to generate a list of integers is much quicker than some <em>progressive index of</em> shenanigans to do the same thing.
At the end of the day, I think I prefer the flat solution :)
</div>

      <!-- Body is included in the above file -->
    </section>
    
      <!-- A footer-ish thing above the actual boring footer for pretty
           fleurons and things that should only appear on posts. -->
      <div style="text-align:center;">
        <img class="center-block-dark" src="../images/fleuron-dark.svg" style="max-width: 3cm" alt="End of post fleuron">
        <img class="center-block-light" src="../images/fleuron.svg" style="max-width: 3cm" alt="End of post fleuron">
        Have a comment? Write me an <a href="../about.html">email!</a>
      </div>
    
</article>


        </div>
        <div id="footer">
          <!-- Left -->
          <a id="to-top" href="#">top</a>
          <!-- Right -->
          <a href="../atom.xml" style="font-variant:small-caps">rss</a>
          &nbsp;|&nbsp;
          <a href="https://github.com/slotThe/slotThe.github.io">Website source</a>
          &nbsp;|&nbsp;
          <a href="../impressum.html">Legal notice and privacy policy</a>
        </div>
      </div>
    </div>
  </body>
</html>
