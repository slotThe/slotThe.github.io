<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
      <meta name="robots" content="noai, noimageai">
    

    
      <title>About This Website Â· Tony Zorman</title>
    

    <link rel="shortcut icon" href="./favicon.png">
    <!-- https://purecss.io/ -->
    <link rel="stylesheet" type="text/css" href="./css/pure-min.css" />
    <link rel="stylesheet" type="text/css" href="./css/skin.css" />
    <!-- Default appearance -->
    <link rel="stylesheet" type="text/css" href="./css/colours.css" />
    <link rel="stylesheet" type="text/css" href="./css/fonts.css" />
    <link rel="stylesheet" type="text/css" href="./css/default.css" />
    <!-- Syntax highlighting -->
    <link rel="stylesheet" type="text/css" href="./css/pygments.css" />
    <link rel="stylesheet" type="text/css" href="./css/katex.css" />
    <!-- Margin and sidenotes -->
    <link rel="stylesheet" type="text/css" href="./css/sidenotes.css" />
  </head>

  <body class="pure-skin-solid">
    <div class="pure-g-r">
      <div class="pure-u-1-4">
        <div id="navigation" class="no-print">
          <div class="pure-menu pure-menu-open">
            <a href="./" class="pure-menu-heading menu-title">
              Blog<br>
              <span class="menu-subtitle">Tony Zorman</span>
            </a>
            <ul>
              <li><a href="./posts.html">Posts</a></li>
              <li><a href="./research.html">Research</a></li>
              <li><a href="./free-software.html">Free Software</a></li>
              <li><a href="./about.html">About</a></li>
            </ul>
          </div>
        </div>
        <!-- A table of contents on the left side, but only for screens
             that are big enough -->
         
          <div id="contents-big">
            <p class="mini-header">Contents <a id="up-arrow" href="#">â†‘</a></p>
            <ul>
<li><a href="#sidenotes">Sidenotes</a></li>
<li><a href="#syntax-highlighting">Syntax highlighting</a></li>
<li><a href="#katex-rendering">KaTeX rendering</a></li>
<li><a href="#section-marks">Section marks</a></li>
<li><a href="#bibtex">BibTeX</a></li>
<li><a href="#no-javascript">No JavaScript</a></li>
<li><a href="#fonts">Fonts</a></li>
</ul>
          </div>
         
      </div>
      <div class="pure-u-3-4">
        <div id="content">
          <!-- We want to include the RSS/Atom feed in certain scenarios,
               but this shouldn't mangle the above header title. -->
           
            <h1>About This Website</h1>
           

          <article>
    <p class="header">
      
        Posted on 2024-10-03
      
      
        &thinsp;Â·&thinsp; last modified: 2024-11-23
      
      
      
    </p>
    <section>
      <!-- A table of contents inline in the text, in case the screen is
           too small for the one in the `default.html' template -->
      <!-- A table of contents inline in the text, in case the screen is too
     small for the one in the `default.html' template -->

  <div id="contents">
    <p class="mini-header">Contents</p>
    <ul>
<li><a href="#sidenotes">Sidenotes</a></li>
<li><a href="#syntax-highlighting">Syntax highlighting</a></li>
<li><a href="#katex-rendering">KaTeX rendering</a></li>
<li><a href="#section-marks">Section marks</a></li>
<li><a href="#bibtex">BibTeX</a></li>
<li><a href="#no-javascript">No JavaScript</a></li>
<li><a href="#fonts">Fonts</a></li>
</ul>
  </div>

<div>
  First of: this site is hosted via <a href="https://pages.github.com/">GitHub Pages</a>,
and the full source code is available on <a href="https://github.com/slotThe/slotThe.github.io">Microsoft GitHub</a>.
<p></p>
My static site generator of choice is <a href="https://jaspervdj.be/hakyll/">hakyll</a>,
which leverages <a href="https://pandoc.org/">pandoc</a> for the actual rendering.
While the bulk of the work is done by these two programs,
there are a few thin layers on top for, e.g., prerendering LaTeX.
With the bundled nix flake,
building should hopefully be deterministic enough that a simple <code>make watch</code> creates a preview server.
<p></p>
Most of what makes the site â€œuniqueâ€ is already stated in the <span class="small-caps">readme</span>;
however, this page gives me the chance to expand on some of the ideas,
should they not have gotten their own blog post already.
<h2 id="sidenotes">Sidenotes<a href="#sidenotes" class="floatleft sec-link">Â§</a></h2>
<p></p>
Sidenotesâ€”as opposed to footnotesâ€”are implemented using
(a somewhat customised) <a href="https://github.com/edwardtufte/tufte-css">Tufte <span class="small-caps">css</span></a>,
as well as <a href="https://github.com/jez/pandoc-sidenote/blob/master/src/Text/Pandoc/SideNoteHTML.hs">SideNotes<span class="small-caps">html</span>.hs</a> from the <code>pandoc-sidenote</code> library.<!--
--><label for="sn-0" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-0" class="margin-toggle" /><div class="sidenote">Here is an example!
By the way, you might notice some links having a little <code>Â°</code> after themâ€”these are links to this domain.
Iâ€™m honestly still not sure this is useful in any way, but I quite like the eye candy.</div><!--
-->
While this uses absolutely no JavaScript,
unlike most pure <span class="small-caps">css</span> implementations
it allows arbitrary blocks to be placed inside of sidenotes.
Iâ€™ve written about the implementation details <a href="https://tony-zorman.com/posts/block-sidenotes.html" class="local-link">here</a>.
<h2 id="syntax-highlighting">Syntax highlighting<a href="#syntax-highlighting" class="floatleft sec-link">Â§</a></h2>
<p></p>
Syntax highlighting it not provided by
<a href="https://hackage.haskell.org/package/skylighting">Skylighting</a>,
as pandoc would normally do,
but rather by
<a href="https://pygments.org/">pygments</a>.
It provides better highlighting and supports a lot more languages,
so I really see no reason not to use it.
Iâ€™ve written about transitioning to pygments <a href="https://tony-zorman.com/posts/pygmentising-hakyll.html" class="local-link">here</a>.
<h2 id="katex-rendering">KaTeX rendering<a href="#katex-rendering" class="floatleft sec-link">Â§</a></h2>
<p></p>
All LaTeX output is pregenerated with <a href="https://katex.org/">KaTeX</a> and directly embedded into the <span class="small-caps">html</span>.
This speeds up page loading, and eliminates the need for client-side JavaScript completely.
Since this is a static site without comments or any other kind of user-generated content,
it seems almost comical to still require every visitor to render the same thing,
rather than doing it once server-side.
<p></p>
Interfacing with KaTeX is done with the tiny <a href="./scripts/math.ts" class="local-link">math.ts</a> script:
<div class="highlight-TypeScript" style="padding-left: 1em;"><pre><span></span><span class="c1">// Source: https://github.com/jgm/pandoc/issues/6651#issuecomment-1099727774</span>

<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">readLines</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;https://deno.land/std@0.224.0/io/mod.ts&quot;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">katex</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.mjs&quot;</span><span class="p">;</span>

<span class="k">for</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">readLines</span><span class="p">(</span><span class="nx">Deno</span><span class="p">.</span><span class="nx">stdin</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">DISPLAY</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;:DISPLAY &quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">useDisplay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">line</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">DISPLAY</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">cleanLine</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nx">useDisplay</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">line</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">DISPLAY</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">line</span><span class="p">;</span>
<span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">katex</span><span class="p">.</span><span class="nx">renderToString</span><span class="p">(</span><span class="nx">cleanLine</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">displayMode</span><span class="o">:</span><span class="w"> </span><span class="kt">useDisplay</span><span class="p">,</span>
<span class="w">      </span><span class="nx">strict</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;error&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nx">throwOnError</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">    </span><span class="p">}));</span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Input: </span><span class="si">${</span><span class="nx">line</span><span class="si">}</span><span class="sb">\n\nError: </span><span class="si">${</span><span class="nx">error</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p></p>
On the hakyll site, all thatâ€™s needed to interface with this is <a href="https://github.com/slotThe/slotThe.github.io/blob/e0c723fbff7ebd21551752c2039a7cf4aef7643f/src/site.hs#L591">hlKaTeX</a>.
Some more implementation considerations are mentioned in a
<a href="https://tony-zorman.com/posts/katex-with-hakyll.html" class="local-link">dedicated post</a>.
<h2 id="section-marks">Section marks<a href="#section-marks" class="floatleft sec-link">Â§</a></h2>
<p></p>
This is a very small thing,
but I think many sites get section marks â€œwrongâ€ by placing them at the <em>end</em> of the headline.
This makes them appear somewhat â€œraggedâ€ to me,
even if they are hidden most of the time anyways.
Here, they are instead moved to the left side of the heading,
in the space between the table of contents (or sidebar) and the main content.
<h2 id="bibtex">BibTeX<a href="#bibtex" class="floatleft sec-link">Â§</a></h2>
<p></p>
Citations are handled by BibTeX;
Iâ€™m used to it from writing LaTeX, and it sports some neat pandoc integration.
There is a â€œReferencesâ€ sectionâ€”not mentioned in the <span class="small-caps">toc</span>â€”at the end of the document,
where all citations the page may have mentioned reside and are properly aligned in a table.
Clicking on any of
<span class="citation" data-cites="category-theory-in-context_riehl">[<a href="#ref-category-theory-in-context_riehl" role="doc-biblioref">Rieh17</a>]</span>,
<span class="citation" data-cites="kelly82:basic">[<a href="#ref-kelly82:basic" role="doc-biblioref">Kell82</a>]</span>, or
<span class="citation" data-cites="Etingof2015">[<a href="#ref-Etingof2015" role="doc-biblioref">EGNO15</a>]</span>
should jump you to it.
<p></p>
Under the hood, pandocâ€”by means of <a href="https://github.com/jgm/citeproc">citeproc</a>â€”uses some convoluted <span class="small-caps">xml</span> format to describe how citations ought to look.
Not finding anything that Iâ€™m completely happy with, the site is currently using a
<a href="https://github.com/slotThe/slotThe.github.io/blob/main/bib/style.csl">hacked-on version</a>
of an
<a href="https://www.zotero.org/styles/din-1505-2-alphanumeric">alphanumeric DIN 1505-2 style</a>,
which most reminded me of BibLaTeXâ€™s <code>alphabetic</code> style.
Iâ€™ve written many more words about this <a href="https://tony-zorman.com/posts/hakyll-and-bibtex.html" class="local-link">here</a>.
<h2 id="no-javascript">No JavaScript<a href="#no-javascript" class="floatleft sec-link">Â§</a></h2>
<p></p>
As many of the above points already hint at,
not using any JavaScript is an explicit goal.
Relatedly, I am aiming for a usable site in text-based browser such as <code>eww</code>.
Some eye candy like small-caps, as well as features such as sidenotes are obviously lost,
but the main content should still be comfortably viewable.
<h2 id="fonts">Fonts<a href="#fonts" class="floatleft sec-link">Â§</a></h2>
<p></p>
This website usesâ€”at least if you let itâ€”lots of <a href="https://github.com/slotThe/slotThe.github.io/tree/main/css/fonts">custom fonts</a>.
The default serif font is Alegreya,
and my own build of Iosevka stands in for anything monospaced.
Plus, since Iâ€™m using KaTeX for <a href="#katex-rendering">rendering maths</a>,
there are quite a few LaTeX fonts loaded whenever a page needs them.
While the site of course works with system fonts as well,
there has been a somewhat conscious choice to deviate from them.
Especially code should look exactly as it appears in my editor,
which is especially relevant when it comes to alignment<!--
-->â€”Unicode characters may indeed have different apparent widths!
Further, lots of system fonts do not support some typographical features,
such as small caps,
that I think give this site a certain â€œflairâ€.<!--
--><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle" /><div class="sidenote">Instead of proper small caps, many system fonts scale down their capital letters.
This makes them entirely too thin, and really rather ugly looking.</div><!--
-->
<p></p>
I do, however, want to make sure that Iâ€™m not sending 2mb per font to every visitor.
The <a href="https://en.wikipedia.org/wiki/Web_Open_Font_Format">Web Open Font Format</a> exists specifically for this purpose,
but even that is not enough in a lot of cases.
Fonts are quite fully featured nowadays,
containing almost every glyph under the sun,
which just blows up their size a lot.
There thankfully exist some neat tools for ripping out unwanted Unicode code points,
only retaining a subset of them;
Iâ€™m using a combination of the <a href="https://fonttools.readthedocs.io/">fontTools</a> Python library,
and the bundled <a href="https://fonttools.readthedocs.io/en/latest/subset/">pyftsubset</a> application.
Hereâ€™s the bash scriptâ€”mostly stolen from <a href="https://xeiaso.net/blog/iaso-fonts">Xe Iaso</a>â€”that turns the given <code>.ttf</code> font into <code>.woff2</code>,
already removing some characters.
<div class="highlight-Bash" style="padding-left: 1em;"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="c1">#</span>
<span class="c1"># Source: https://xeiaso.net/blog/iaso-fonts/</span>
<span class="c1">#</span>
<span class="c1"># Some Unicode symbols added.</span>

<span class="nv">base</span><span class="o">=</span><span class="s2">&quot;U+0000-00A0,U+00A2-00A9,U+00AC-00AE,U+00B0-00B7,U+00B9-00BA,U+00BC-00BE,U+00D7,U+00F7,U+2000-206F,U+2074,U+20AC,U+2122,U+2190-21BB,U+2212,U+2215,U+F8FF,U+FEFF,U+FFFD,U+00E8,U+00E9,U+00F2,U+00F3,U+00E4,U+00C4,U+00D6,U+00DC,U+00F6,U+00FC,U+203D&quot;</span>

<span class="c1"># âˆ˜â—‹âŠ¸âŸœâŒ¾âŠ˜â—¶â‰âš‡âŸâŠË™ËœË˜Â¨âŒœâ¼Â´Ë`+Ã—Ã·â‹†âˆšâŒŠâŒˆ|Â¬âˆ§âˆ¨&lt;&gt;â‰ =â‰¤â‰¥â‰¡â‰¢âŠ£âŠ¢â¥Šâˆ¾â‰â‹ˆâ†‘â†“â†•Â«Â»âŒ½â‰/â‹â’âŠâŠ‘âŠâŠ’âˆŠâ·âŠ”!-â€¿,â‹„â†â‡â†©âŸ¨âŸ©ğ”½ğ”¾ğ•ğ•ğ•Šğ•—ğ•˜ğ•¨ğ•©ğ•¤ğ•£Ï€âˆÂ¯â”Œâ”€â•µâ•â”†â”Šâ”˜â€¢Â·â‡’â”‚â””â</span>
<span class="nv">bqn_symbols</span><span class="o">=</span><span class="s2">&quot;U+2218,U+25CB,U+22B8,U+27DC,U+233E,U+2298,U+25F6,U+2389,U+2687,U+235F,U+238A,U+02D9,U+02DC,U+02D8,U+A8,U+231C,U+207C,U+B4,U+02DD,U+0060,U+002B,U+00D7,U+00F7,U+22C6,U+221A,U+230A,U+2308,U+007C,U+00AC,U+2227,U+2228,U+003C,U+003E,U+2260,U+003D,U+2264,U+2265,U+2261,U+2262,U+22A3,U+22A2,U+294A,U+223E,U+224D,U+22C8,U+2191,U+2193,U+2195,U+00AB,U+00BB,U+233D,U+2349,U+002F,U+234B,U+2352,U+228F,U+2291,U+2290,U+2292,U+220A,U+2377,U+2294,U+0021,U+002D,U+203F,U+002C,U+22C4,U+2190,U+21D0,U+21A9,U+27E8,U+27E9,U+1D53D,U+1D53E,U+1D54E,U+1D54F,U+1D54A,U+1D557,U+1D558,U+1D568,U+1D569,U+1D564,U+1D563,U+03C0,U+221E,U+AF,U+250C,U+2500,U+2575,U+254E,U+2506,U+250A,U+2518,U+2022,U+00B7,U+21D2,U+2502,U+2514,U+234E&quot;</span>

pyftsubset<span class="w"> </span><span class="nv">$1</span><span class="w"> </span>--output-file<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="p">%.*</span><span class="si">}</span><span class="s2">&quot;</span>.woff2<span class="w"> </span>--flavor<span class="o">=</span>woff2<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>--no-hinting<span class="w"> </span>--desubroutinize<span class="w"> </span>--layout-features<span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>--unicodes<span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">base</span><span class="si">}</span><span class="s2">,</span><span class="si">${</span><span class="nv">bqn_symbols</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>

<p></p>
Using <code>fontTools</code> directly, we can even more aggressively massage this,
and only concentrate on the characters that are actually used in the generated <span class="small-caps">html</span> pages.
<div class="highlight-Python" style="padding-left: 1em;"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">fontTools.ttLib</span><span class="w"> </span><span class="kn">import</span> <span class="n">TTFont</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fontTools.subset</span><span class="w"> </span><span class="kn">import</span> <span class="n">Subsetter</span><span class="p">,</span> <span class="n">Options</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_used_chars</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;Â°&quot;</span><span class="p">)</span>
    <span class="p">[</span>
        <span class="n">res</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fs</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.html&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">optimise_font</span><span class="p">(</span><span class="n">in_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">out_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="n">hinting</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">desubroutinize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;Alegreya&quot;</span> <span class="ow">in</span> <span class="n">in_file</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">layout_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]</span>
    <span class="n">font</span> <span class="o">=</span> <span class="n">TTFont</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">flavor</span><span class="o">=</span><span class="s2">&quot;woff2&quot;</span><span class="p">)</span>
    <span class="n">subs</span> <span class="o">=</span> <span class="n">Subsetter</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
    <span class="n">subs</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
    <span class="n">subs</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
    <span class="n">font</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span>
    <span class="n">font</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Size for </span><span class="si">{</span><span class="n">Path</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2"> changed from &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span><span class="o">/</span><span class="mi">1024</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">KB &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;to </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span><span class="o">/</span><span class="mi">1024</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">KB&quot;</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">PR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PROJECT_ROOT&quot;</span><span class="p">]</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">get_used_chars</span><span class="p">(</span><span class="n">PR</span> <span class="o">+</span> <span class="s2">&quot;/docs&quot;</span><span class="p">)</span>
    <span class="n">in_path</span> <span class="o">=</span> <span class="n">PR</span> <span class="o">+</span> <span class="s2">&quot;/uncompressed_fonts/&quot;</span>
    <span class="n">out_path</span> <span class="o">=</span> <span class="n">PR</span> <span class="o">+</span> <span class="s2">&quot;/css/fonts/&quot;</span>
    <span class="c1"># XXX: I don't know why this two-stage process creates smaller fonts than</span>
    <span class="c1"># either step on its own, but it does. Should probably investigate the</span>
    <span class="c1"># pyftsubset source code at some point.</span>
    <span class="k">for</span> <span class="n">font</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">in_path</span><span class="p">):</span>  <span class="c1"># Create woff2</span>
        <span class="k">if</span> <span class="n">font</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.ttf&quot;</span><span class="p">):</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">PR</span> <span class="o">+</span> <span class="s2">&quot;/scripts/compress-fonts.sh&quot;</span><span class="p">,</span> <span class="n">in_path</span> <span class="o">+</span> <span class="n">font</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">font</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">in_path</span><span class="p">):</span>  <span class="c1"># Further optimise font</span>
        <span class="k">if</span> <span class="n">font</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.woff2&quot;</span><span class="p">):</span>
            <span class="n">optimise_font</span><span class="p">(</span><span class="n">in_path</span> <span class="o">+</span> <span class="n">font</span><span class="p">,</span> <span class="n">out_path</span> <span class="o">+</span> <span class="n">font</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

<p></p>
This two-step process results in smaller files than each individual script on its own.<!--
--><label for="sn-2" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-2" class="margin-toggle" /><div class="sidenote">At some point I will look into the source code for <code>pyftsubset</code>
to see which magic switch I have to activate so that <code>compress-fonts.sh</code> is no longer needed.
Not today, though.</div><!--
-->
<hr />
<p></p>
Getting code points in bulk,
without explicitly looking them up one by one,
is just a matter of converting characters to their hex representations,
which is trivial to do.
For example, the Emacs lisp snippet
<div class="highlight-emacs-lisp" style="padding-left: 1em;"><pre><span></span><span class="p">(</span><span class="nf">mapconcat</span>
<span class="w"> </span><span class="p">(</span><span class="nv">-partial</span><span class="w"> </span><span class="nf">#'format</span><span class="w"> </span><span class="s">&quot;U+%04X&quot;</span><span class="p">)</span>
<span class="w"> </span><span class="s">&quot;âˆ˜â—‹âŠ¸âŸœâŒ¾âŠ˜â—¶â‰âš‡âŸâŠË™ËœË˜Â¨âŒœâ¼Â´Ë`+Ã—Ã·â‹†âˆšâŒŠâŒˆ|Â¬âˆ§âˆ¨&lt;&gt;â€¦&quot;</span>
<span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">)</span>
</pre></div>

<p></p>
results in an output along the lines of
<div class="highlight-emacs-lisp" style="padding-left: 1em;"><pre><span></span><span class="s">&quot;U+2218,U+25CB,U+22B8,U+27DC,U+233Eâ€¦&quot;</span>
</pre></div>

<h2 id="references">References<a href="#references" class="floatleft sec-link">Â§</a></h2>
<div id="refs" class="references csl-bib-body" role="list">
<table>
<tbody>
<tr class="odd">
<td><div id="ref-Etingof2015" class="csl-entry" role="listitem">
<div class="csl-left-margin">[EGNO15] </div>
</div></td>
<td> </td>
<td><div class="csl-right-inline"><span class="smallcaps">Pavel Etingof</span> and <span class="smallcaps">Shlomo Gelaki</span> and <span class="smallcaps">Dmitri Nikshych</span> and <span class="smallcaps">Victor Ostrik</span>: <em><a href="https://doi.org/10.1090/surv/205">Tensor categories</a></em>, <em>Mathematical surveys and monographs</em>. vol. 205: American Mathematical Society, Providence, RI, 2015; Â ISBNÂ 978-1-4704-2024-6</div></td>
</tr>
<tr class="even">
<td><div id="ref-kelly82:basic" class="csl-entry" role="listitem">
<div class="csl-left-margin">[Kell82] </div>
</div></td>
<td> </td>
<td><div class="csl-right-inline"><span class="smallcaps">Gregory Maxwell Kelly</span>: <em>Basic concepts of enriched category theory</em>, <em>Lond. Math. Soc. Lect. Note ser.</em> vol. 64: Cambridge University Press, Cambridge. London Mathematical Society, London, 1982</div></td>
</tr>
<tr class="odd">
<td><div id="ref-category-theory-in-context_riehl" class="csl-entry" role="listitem">
<div class="csl-left-margin">[Rieh17] </div>
</div></td>
<td> </td>
<td><div class="csl-right-inline"><span class="smallcaps">E. Riehl</span>: <em><a href="https://math.jhu.edu/~eriehl/context.pdf">Category theory in context</a></em>, <em>Aurora: Dover modern math originals</em>: Dover Publications, 2017; Â ISBNÂ 9780486820804</div></td>
</tr>
</tbody>
</table>
</div>
</div>

      <!-- Body is included in the above file -->
    </section>
    
</article>


        </div>
        <div id="footer">
          <!-- Left -->
          <a id="to-top" href="#">top</a>
          <!-- Right -->
          <a href="./atom.xml" style="font-variant:small-caps">rss</a>
          &nbsp;|&nbsp;
          <a href="https://github.com/slotThe/slotThe.github.io">Website source</a>
          &nbsp;|&nbsp;
          <a href="./impressum.html">Legal notice and privacy policy</a>
        </div>
      </div>
    </div>
  </body>
</html>
